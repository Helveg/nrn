steps:
  - checkout: self
    submodules: true
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(python.version)'
  - script: |
      python -m pip install -U pip setuptools wheel
      python -m pip install 'Jinja2>=2.9.3' 'PyYAML>=3.13' 'pytest' 'sympy>=1.3' 'scipy' 'cython'
    displayName: 'Install Python Depdendencies'
  - script: |
      export SDKROOT=$(xcrun --sdk macosx --show-sdk-path) || echo "Non-OSX Platform!"
      export PATH=$(EXTRA_PATH):$PATH
      mkdir -p $(Build.Repository.LocalPath)/build
      cd $(Build.Repository.LocalPath)/build
      cmake .. -DCMAKE_INSTALL_PREFIX=$(INSTALL_DIR) -DNRN_ENABLE_CORENEURON=ON
      make -j 2 install
    displayName: 'Build and Install'
  - script: |
      export PATH=$(INSTALL_DIR)/bin:$PATH
      export PYTHONPATH=$(INSTALL_DIR)/lib/python:$PYTHONPATH
      python --version
      ls $(INSTALL_DIR)
      ls $(INSTALL_DIR)/lib/python
      python -c 'import neuron; neuron.test()'
    displayName: 'Run Tests'
