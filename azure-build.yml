steps:
  - checkout: self
    submodules: false
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(python.azure.version)'
  - script: |
      python -m pip install -U pip setuptools wheel
      python -m pip install 'Jinja2>=2.9.3' 'PyYAML>=3.13' 'pytest' 'sympy>=1.3' 'scipy' 'cython'
    displayName: 'Install Python Depdendencies'
  - script: |
      export PATH=/usr/local/opt/flex/bin:/usr/local/opt/bison/bin:$PATH
      export SDKROOT=$(xcrun --sdk macosx --show-sdk-path) || echo "Not OSX Platform"
      mkdir -p $(Build.Repository.LocalPath)/build
      cd $(Build.Repository.LocalPath)/build
      cmake .. -DCMAKE_INSTALL_PREFIX=$(INSTALL_DIR) -DNRN_ENABLE_CORENEURON=ON
      make -j 2 install
    displayName: 'Build and Install'
  - script: |
      export PATH=$(INSTALL_DIR)/bin:$PATH
      export PYTHONPATH=$(INSTALL_DIR)/lib/python:$PYTHONPATH
      python -c 'import neuron; neuron.test()'
    displayName: 'Run Tests'
